{% extends 'my_admin/base.html' %}

{% block title %}Curriculum Management - EduMore360 Admin{% endblock %}

{% block page_title %}Curriculum Management{% endblock %}

{% block extra_css %}
<style>
    .tab-content {
        padding-top: 1.5rem;
    }

    /* Fix for white switch on white background */
    .nav-tabs .nav-link {
        color: #4e73df;
        background-color: #f8f9fc;
        border: 1px solid #e3e6f0;
        margin-right: 2px;
    }

    .nav-tabs .nav-link.active {
        color: #fff;
        background-color: #4e73df;
        border-color: #4e73df;
    }

    .nav-tabs .nav-link:hover {
        background-color: #eaecf4;
    }

    /* Mobile-friendly styles */
    @media (max-width: 768px) {
        .table-responsive {
            overflow-x: auto;
        }

        .table th, .table td {
            white-space: nowrap;
        }

        .modal-dialog {
            margin: 0.5rem;
            max-width: calc(100% - 1rem);
        }

        .nav-tabs .nav-link {
            padding: 0.5rem;
            font-size: 0.9rem;
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }

        .card-header {
            padding: 0.75rem;
        }

        .card-body {
            padding: 1rem;
        }

        .form-control {
            font-size: 0.9rem;
        }
    }
</style>
{% endblock %}

{% block content %}

<!-- Modal Definitions -->
<!-- Add Curriculum Modal -->
<div class="modal fade" id="addCurriculumModal" tabindex="-1" aria-labelledby="addCurriculumModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addCurriculumModalLabel">Add New Curriculum</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/my-admin/curriculum/add-curriculum/" method="post">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="curriculum_name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="curriculum_name" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="curriculum_code" class="form-label">Code</label>
                        <input type="text" class="form-control" id="curriculum_code" name="code" required>
                    </div>
                    <div class="mb-3">
                        <label for="curriculum_country" class="form-label">Country</label>
                        <input type="text" class="form-control" id="curriculum_country" name="country" required>
                    </div>
                    <div class="mb-3">
                        <label for="curriculum_description" class="form-label">Description</label>
                        <textarea class="form-control" id="curriculum_description" name="description" rows="3"></textarea>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="curriculum_is_active" name="is_active" checked>
                        <label class="form-check-label" for="curriculum_is_active">Active</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Curriculum</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Class Level Modal -->
<div class="modal fade" id="addClassLevelModal" tabindex="-1" aria-labelledby="addClassLevelModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addClassLevelModalLabel">Add New Class Level</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/my-admin/curriculum/add-class-level/" method="post">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="class_level_name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="class_level_name" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="class_level_curriculum" class="form-label">Curriculum</label>
                        <select class="form-control" id="class_level_curriculum" name="curriculum" required>
                            <option value="">Select Curriculum</option>
                            {% for curriculum in curricula %}
                                <option value="{{ curriculum.id }}">{{ curriculum.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="class_level_order" class="form-label">Order</label>
                        <input type="number" class="form-control" id="class_level_order" name="order" min="1" value="1" required>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="class_level_is_active" name="is_active" checked>
                        <label class="form-check-label" for="class_level_is_active">Active</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Class Level</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Subject Modal -->
<div class="modal fade" id="addSubjectModal" tabindex="-1" aria-labelledby="addSubjectModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addSubjectModalLabel">Add New Subject</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/my-admin/curriculum/add-subject/" method="post">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="subject_name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="subject_name" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="subject_curriculum" class="form-label">Curriculum</label>
                        <select class="form-control" id="subject_curriculum" name="curriculum" required>
                            <option value="">Select Curriculum</option>
                            {% for curriculum in curricula %}
                                <option value="{{ curriculum.id }}">{{ curriculum.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="subject_class_level" class="form-label">Class Level</label>
                        <select class="form-control" id="subject_class_level" name="class_level" required>
                            <option value="">Select Class Level</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="subject_description" class="form-label">Description</label>
                        <textarea class="form-control" id="subject_description" name="description" rows="3"></textarea>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="subject_is_active" name="is_active" checked>
                        <label class="form-check-label" for="subject_is_active">Active</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Subject</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Topic Modal -->
<div class="modal fade" id="addTopicModal" tabindex="-1" aria-labelledby="addTopicModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addTopicModalLabel">Add New Topic</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/my-admin/curriculum/add-topic/" method="post">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="topic_name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="topic_name" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="topic_subject" class="form-label">Subject</label>
                        <select class="form-control" id="topic_subject" name="subject" required>
                            <option value="">Select Subject</option>
                            {% for subject in subjects %}
                                <option value="{{ subject.id }}">{{ subject.name }} ({{ subject.class_level.name }} - {{ subject.curriculum.name }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="topic_order" class="form-label">Order</label>
                        <input type="number" class="form-control" id="topic_order" name="order" min="1" value="1" required>
                    </div>
                    <div class="mb-3">
                        <label for="topic_description" class="form-label">Description</label>
                        <textarea class="form-control" id="topic_description" name="description" rows="3"></textarea>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="topic_is_active" name="is_active" checked>
                        <label class="form-check-label" for="topic_is_active">Active</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Topic</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Curriculum Tabs -->
<div class="row mb-4">
    <div class="col-12">
        <ul class="nav nav-tabs flex-column flex-md-row" id="curriculumTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active w-100 text-start" id="curricula-tab" data-bs-toggle="tab" data-bs-target="#curricula" type="button" role="tab" aria-controls="curricula" aria-selected="true">
                    <i class="fas fa-book-open me-2"></i>Curricula
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link w-100 text-start" id="class-levels-tab" data-bs-toggle="tab" data-bs-target="#class-levels" type="button" role="tab" aria-controls="class-levels" aria-selected="false">
                    <i class="fas fa-layer-group me-2"></i>Class Levels
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link w-100 text-start" id="subjects-tab" data-bs-toggle="tab" data-bs-target="#subjects" type="button" role="tab" aria-controls="subjects" aria-selected="false">
                    <i class="fas fa-book me-2"></i>Subjects
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link w-100 text-start" id="topics-tab" data-bs-toggle="tab" data-bs-target="#topics" type="button" role="tab" aria-controls="topics" aria-selected="false">
                    <i class="fas fa-list me-2"></i>Topics
                </button>
            </li>
        </ul>
    </div>
</div>

<div class="tab-content" id="curriculumTabsContent">
    <!-- Curricula Tab -->
    <div class="tab-pane fade show active" id="curricula" role="tabpanel" aria-labelledby="curricula-tab">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">All Curricula</h6>
                <button type="button" class="btn btn-sm btn-primary" id="showAddCurriculumModal">
                    <i class="fas fa-plus"></i> Add Curriculum
                </button>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <input type="text" class="table-search" id="curriculaSearch" placeholder="Search curricula...">
                </div>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover" id="curriculaTable" width="100%" cellspacing="0">
                        <thead class="table-light">
                            <tr>
                                <th>Name</th>
                                <th>Code</th>
                                <th>Country</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for curriculum in curricula %}
                            <tr>
                                <td>{{ curriculum.name }}</td>
                                <td>{{ curriculum.code }}</td>
                                <td>{{ curriculum.country }}</td>
                                <td>
                                    {% if curriculum.is_active %}
                                        <span class="badge bg-success text-white">Active</span>
                                    {% else %}
                                        <span class="badge bg-danger text-white">Inactive</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-primary edit-curriculum-btn" data-id="{{ curriculum.id }}" data-name="{{ curriculum.name }}" data-code="{{ curriculum.code }}" data-country="{{ curriculum.country }}" data-description="{{ curriculum.description }}" data-active="{{ curriculum.is_active }}">
                                        <i class="fas fa-edit"></i> <span class="d-none d-md-inline">Edit</span>
                                    </button>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center">No curricula found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Class Levels Tab -->
    <div class="tab-pane fade" id="class-levels" role="tabpanel" aria-labelledby="class-levels-tab">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">All Class Levels</h6>
                <button type="button" class="btn btn-sm btn-primary" id="showAddClassLevelModal">
                    <i class="fas fa-plus"></i> Add Class Level
                </button>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <input type="text" class="table-search" id="classLevelsSearch" placeholder="Search class levels...">
                </div>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover" id="classLevelsTable" width="100%" cellspacing="0">
                        <thead class="table-light">
                            <tr>
                                <th>Name</th>
                                <th>Curriculum</th>
                                <th>Order</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for class_level in class_levels %}
                            <tr>
                                <td>{{ class_level.name }}</td>
                                <td>{{ class_level.curriculum.name }}</td>
                                <td>{{ class_level.order }}</td>
                                <td>
                                    {% if class_level.is_active %}
                                        <span class="badge bg-success text-white">Active</span>
                                    {% else %}
                                        <span class="badge bg-danger text-white">Inactive</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-primary edit-class-level-btn" data-id="{{ class_level.id }}" data-name="{{ class_level.name }}" data-curriculum="{{ class_level.curriculum.id }}" data-order="{{ class_level.order }}" data-active="{{ class_level.is_active }}">
                                        <i class="fas fa-edit"></i> <span class="d-none d-md-inline">Edit</span>
                                    </button>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center">No class levels found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Subjects Tab -->
    <div class="tab-pane fade" id="subjects" role="tabpanel" aria-labelledby="subjects-tab">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">All Subjects</h6>
                <button type="button" class="btn btn-sm btn-primary" id="showAddSubjectModal">
                    <i class="fas fa-plus"></i> Add Subject
                </button>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <input type="text" class="table-search" id="subjectsSearch" placeholder="Search subjects...">
                </div>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover" id="subjectsTable" width="100%" cellspacing="0">
                        <thead class="table-light">
                            <tr>
                                <th>Name</th>
                                <th>Curriculum</th>
                                <th>Class Level</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for subject in subjects %}
                            <tr>
                                <td>{{ subject.name }}</td>
                                <td>{{ subject.curriculum.name }}</td>
                                <td>{{ subject.class_level.name }}</td>
                                <td>
                                    {% if subject.is_active %}
                                        <span class="badge bg-success text-white">Active</span>
                                    {% else %}
                                        <span class="badge bg-danger text-white">Inactive</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-primary edit-subject-btn" data-id="{{ subject.id }}" data-name="{{ subject.name }}" data-curriculum="{{ subject.curriculum.id }}" data-class-level="{{ subject.class_level.id }}" data-description="{{ subject.description }}" data-active="{{ subject.is_active }}">
                                        <i class="fas fa-edit"></i> <span class="d-none d-md-inline">Edit</span>
                                    </button>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center">No subjects found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Topics Tab -->
    <div class="tab-pane fade" id="topics" role="tabpanel" aria-labelledby="topics-tab">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">All Topics</h6>
                <button type="button" class="btn btn-sm btn-primary" id="showAddTopicModal">
                    <i class="fas fa-plus"></i> Add Topic
                </button>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <input type="text" class="table-search" id="topicsSearch" placeholder="Search topics...">
                </div>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover" id="topicsTable" width="100%" cellspacing="0">
                        <thead class="table-light">
                            <tr>
                                <th>Name</th>
                                <th>Subject</th>
                                <th>Order</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for topic in topics %}
                            <tr>
                                <td>{{ topic.name }}</td>
                                <td>{{ topic.subject.name }}</td>
                                <td>{{ topic.order }}</td>
                                <td>
                                    {% if topic.is_active %}
                                        <span class="badge bg-success text-white">Active</span>
                                    {% else %}
                                        <span class="badge bg-danger text-white">Inactive</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-primary edit-topic-btn" data-id="{{ topic.id }}" data-name="{{ topic.name }}" data-subject="{{ topic.subject.id }}" data-order="{{ topic.order }}" data-description="{{ topic.description }}" data-active="{{ topic.is_active }}">
                                        <i class="fas fa-edit"></i> <span class="d-none d-md-inline">Edit</span>
                                    </button>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center">No topics found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Make sure bootstrap is defined
    console.log('Bootstrap version:', typeof bootstrap);

    // Initialize all modals
    var modals = document.querySelectorAll('.modal');
    modals.forEach(function(modalEl) {
        console.log('Initializing modal:', modalEl.id);
    });

    $(document).ready(function() {
        // Simple search functionality for tables
        function setupTableSearch(tableId, searchId) {
            $('#' + searchId).on('keyup', function() {
                var value = $(this).val().toLowerCase();
                $('#' + tableId + ' tbody tr').filter(function() {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                });
            });
        }

        // Setup search for each table
        setupTableSearch('curriculaTable', 'curriculaSearch');
        setupTableSearch('classLevelsTable', 'classLevelsSearch');
        setupTableSearch('subjectsTable', 'subjectsSearch');
        setupTableSearch('topicsTable', 'topicsSearch');

        // Simple function to show a modal
        function showModal(modalId) {
            var modalEl = document.getElementById(modalId);
            if (modalEl) {
                // Create backdrop
                var backdrop = document.createElement('div');
                backdrop.className = 'modal-backdrop fade show';
                document.body.appendChild(backdrop);

                // Show modal
                modalEl.classList.add('show');
                modalEl.style.display = 'block';
                document.body.classList.add('modal-open');

                // Close on backdrop click
                backdrop.addEventListener('click', function() {
                    hideModal(modalId);
                });

                // Setup close buttons
                var closeButtons = modalEl.querySelectorAll('[data-bs-dismiss="modal"]');
                closeButtons.forEach(function(button) {
                    button.addEventListener('click', function() {
                        hideModal(modalId);
                    });
                });
            } else {
                console.error('Modal element not found:', modalId);
            }
        }

        // Simple function to hide a modal
        function hideModal(modalId) {
            var modalEl = document.getElementById(modalId);
            if (modalEl) {
                // Remove backdrop
                var backdrop = document.querySelector('.modal-backdrop');
                if (backdrop) {
                    backdrop.parentNode.removeChild(backdrop);
                }

                // Hide modal
                modalEl.classList.remove('show');
                modalEl.style.display = 'none';
                document.body.classList.remove('modal-open');
            }
        }

        // Add jQuery modal method
        $.fn.modal = function(action) {
            if (action === 'show') {
                showModal(this.attr('id'));
            } else if (action === 'hide') {
                hideModal(this.attr('id'));
            }
            return this;
        };

        // Event handlers for modal buttons
        $('#showAddCurriculumModal').on('click', function() {
            console.log('Add Curriculum button clicked');
            showModal('addCurriculumModal');
        });

        $('#showAddClassLevelModal').on('click', function() {
            console.log('Add Class Level button clicked');
            showModal('addClassLevelModal');
        });

        $('#showAddSubjectModal').on('click', function() {
            console.log('Add Subject button clicked');
            showModal('addSubjectModal');
        });

        $('#showAddTopicModal').on('click', function() {
            console.log('Add Topic button clicked');
            showModal('addTopicModal');
        });

        // Handle curriculum change in class level form
        $('#subject_curriculum').change(function() {
            var curriculumId = $(this).val();
            if (curriculumId) {
                // Get class levels for this curriculum
                $.getJSON("/quiz/get-class-levels/", {curriculum_id: curriculumId}, function(data) {
                    var options = '<option value="">Select Class Level</option>';
                    $.each(data.class_levels, function(index, classLevel) {
                        options += '<option value="' + classLevel.id + '">' + classLevel.name + '</option>';
                    });
                    $('#subject_class_level').html(options);
                });
            } else {
                $('#subject_class_level').html('<option value="">Select Class Level</option>');
            }
        });

        // Handle edit buttons for curriculum
        $('.edit-curriculum-btn').click(function() {
            console.log('Edit curriculum button clicked');
            var id = $(this).data('id');
            var name = $(this).data('name');
            var code = $(this).data('code');
            var country = $(this).data('country');
            var description = $(this).data('description') || '';
            var isActive = $(this).data('active');

            // Create edit modal dynamically
            var editModalId = 'editCurriculumModal' + id;

            // Remove existing modal if it exists
            var existingModal = document.getElementById(editModalId);
            if (existingModal) {
                existingModal.parentNode.removeChild(existingModal);
            }

            // Create new modal
            var editModal = `
                <div class="modal fade" id="${editModalId}" tabindex="-1" aria-labelledby="editCurriculumModalLabel${id}" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editCurriculumModalLabel${id}">Edit Curriculum</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form action="/my-admin/curriculum/edit-curriculum/${id}/" method="post">
                                {% csrf_token %}
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <label for="curriculum_name_${id}" class="form-label">Name</label>
                                        <input type="text" class="form-control" id="curriculum_name_${id}" name="name" value="${name}" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="curriculum_code_${id}" class="form-label">Code</label>
                                        <input type="text" class="form-control" id="curriculum_code_${id}" name="code" value="${code}" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="curriculum_country_${id}" class="form-label">Country</label>
                                        <input type="text" class="form-control" id="curriculum_country_${id}" name="country" value="${country}" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="curriculum_description_${id}" class="form-label">Description</label>
                                        <textarea class="form-control" id="curriculum_description_${id}" name="description" rows="3">${description}</textarea>
                                    </div>
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="curriculum_is_active_${id}" name="is_active" ${isActive ? 'checked' : ''}>
                                        <label class="form-check-label" for="curriculum_is_active_${id}">Active</label>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;

            // Append modal to body
            $('body').append(editModal);

            // Show the modal using our custom function
            showModal(editModalId);
        });

        // Handle edit buttons for class levels
        $('.edit-class-level-btn').click(function() {
            console.log('Edit class level button clicked');
            var id = $(this).data('id');
            var name = $(this).data('name');
            var curriculum = $(this).data('curriculum');
            var order = $(this).data('order');
            var isActive = $(this).data('active');

            // Create edit modal dynamically
            var editModalId = 'editClassLevelModal' + id;

            // Remove existing modal if it exists
            var existingModal = document.getElementById(editModalId);
            if (existingModal) {
                existingModal.parentNode.removeChild(existingModal);
            }

            // Create new modal
            var editModal = `
                <div class="modal fade" id="${editModalId}" tabindex="-1" aria-labelledby="editClassLevelModalLabel${id}" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editClassLevelModalLabel${id}">Edit Class Level</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form action="/my-admin/curriculum/edit-class-level/${id}/" method="post">
                                {% csrf_token %}
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <label for="class_level_name_${id}" class="form-label">Name</label>
                                        <input type="text" class="form-control" id="class_level_name_${id}" name="name" value="${name}" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="class_level_curriculum_${id}" class="form-label">Curriculum</label>
                                        <select class="form-control" id="class_level_curriculum_${id}" name="curriculum" required>
                                            <option value="">Select Curriculum</option>
                                            {% for curriculum_item in curricula %}
                                                <option value="{{ curriculum_item.id }}">{{ curriculum_item.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="class_level_order_${id}" class="form-label">Order</label>
                                        <input type="number" class="form-control" id="class_level_order_${id}" name="order" value="${order}" min="1" required>
                                    </div>
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="class_level_is_active_${id}" name="is_active" ${isActive ? 'checked' : ''}>
                                        <label class="form-check-label" for="class_level_is_active_${id}">Active</label>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;

            // Append modal to body
            $('body').append(editModal);

            // Show the modal using our custom function
            showModal(editModalId);
        });

        // Handle edit buttons for subjects
        $('.edit-subject-btn').click(function() {
            console.log('Edit subject button clicked');
            var id = $(this).data('id');
            var name = $(this).data('name');
            var curriculum = $(this).data('curriculum');
            var classLevel = $(this).data('class-level');
            var description = $(this).data('description') || '';
            var isActive = $(this).data('active');

            // Create edit modal dynamically
            var editModalId = 'editSubjectModal' + id;

            // Remove existing modal if it exists
            var existingModal = document.getElementById(editModalId);
            if (existingModal) {
                existingModal.parentNode.removeChild(existingModal);
            }

            // Create new modal
            var editModal = `
                <div class="modal fade" id="${editModalId}" tabindex="-1" aria-labelledby="editSubjectModalLabel${id}" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editSubjectModalLabel${id}">Edit Subject</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form action="/my-admin/curriculum/edit-subject/${id}/" method="post">
                                {% csrf_token %}
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <label for="subject_name_${id}" class="form-label">Name</label>
                                        <input type="text" class="form-control" id="subject_name_${id}" name="name" value="${name}" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="subject_curriculum_${id}" class="form-label">Curriculum</label>
                                        <select class="form-control" id="subject_curriculum_${id}" name="curriculum" required>
                                            <option value="">Select Curriculum</option>
                                            {% for curriculum_item in curricula %}
                                                <option value="{{ curriculum_item.id }}">{{ curriculum_item.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="subject_class_level_${id}" class="form-label">Class Level</label>
                                        <select class="form-control" id="subject_class_level_${id}" name="class_level" required>
                                            <option value="">Select Class Level</option>
                                            {% for class_level_item in class_levels %}
                                                <option value="{{ class_level_item.id }}">{{ class_level_item.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="subject_description_${id}" class="form-label">Description</label>
                                        <textarea class="form-control" id="subject_description_${id}" name="description" rows="3">${description}</textarea>
                                    </div>
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="subject_is_active_${id}" name="is_active" ${isActive ? 'checked' : ''}>
                                        <label class="form-check-label" for="subject_is_active_${id}">Active</label>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;

            // Append modal to body
            $('body').append(editModal);

            // Show the modal using our custom function
            showModal(editModalId);
        });

        // Handle edit buttons for topics
        $('.edit-topic-btn').click(function() {
            console.log('Edit topic button clicked');
            var id = $(this).data('id');
            var name = $(this).data('name');
            var subject = $(this).data('subject');
            var order = $(this).data('order');
            var description = $(this).data('description') || '';
            var isActive = $(this).data('active');

            // Create edit modal dynamically
            var editModalId = 'editTopicModal' + id;

            // Remove existing modal if it exists
            var existingModal = document.getElementById(editModalId);
            if (existingModal) {
                existingModal.parentNode.removeChild(existingModal);
            }

            // Create new modal
            var editModal = `
                <div class="modal fade" id="${editModalId}" tabindex="-1" aria-labelledby="editTopicModalLabel${id}" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editTopicModalLabel${id}">Edit Topic</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form action="/my-admin/curriculum/edit-topic/${id}/" method="post">
                                {% csrf_token %}
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <label for="topic_name_${id}" class="form-label">Name</label>
                                        <input type="text" class="form-control" id="topic_name_${id}" name="name" value="${name}" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="topic_subject_${id}" class="form-label">Subject</label>
                                        <select class="form-control" id="topic_subject_${id}" name="subject" required>
                                            <option value="">Select Subject</option>
                                            {% for subject_item in subjects %}
                                                <option value="{{ subject_item.id }}">{{ subject_item.name }} ({{ subject_item.class_level.name }} - {{ subject_item.curriculum.name }})</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="topic_order_${id}" class="form-label">Order</label>
                                        <input type="number" class="form-control" id="topic_order_${id}" name="order" value="${order}" min="1" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="topic_description_${id}" class="form-label">Description</label>
                                        <textarea class="form-control" id="topic_description_${id}" name="description" rows="3">${description}</textarea>
                                    </div>
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="topic_is_active_${id}" name="is_active" ${isActive ? 'checked' : ''}>
                                        <label class="form-check-label" for="topic_is_active_${id}">Active</label>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;

            // Append modal to body
            $('body').append(editModal);

            // Show the modal using our custom function
            showModal(editModalId);
        });
    });
</script>
{% endblock %}
